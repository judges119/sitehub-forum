<p id="notice"><%= notice %></p>

<p>
  <h1><%= @discussion.title %></h1>
</p>

<hr />

<% for post in @discussion.posts %>
  <div>
    <div>
      <% if post.user != nil %>
        <% if current_user == post.user && post.user != nil %>
          User: You!
        <% else %>
          <%= post.user.username %>
        <% end %>
      <% else %>
        [User Deleted]
      <% end %>
      <% if post.id == @discussion.posts.first.id %>
        <% if current_user == post.user || current_user.try(:admin?) || current_user.try(:moderator?) %>
          <%= link_to "Edit Post", edit_discussion_path(@discussion) %>
        <% end %>
        <% if current_user == post.user || current_user.try(:admin?) %>
          <%= link_to "Delete Thread", discussion_path(@discussion), method: :delete, data: { confirm: "Are you sure?" } %>
        <% end %>
      <% else %>
        <% if current_user == post.user || current_user.try(:admin?) || current_user.try(:moderator?) %>
          <%= link_to "Edit Post", edit_post_path(post) %>
        <% end %>
        <% if current_user == post.user || current_user.try(:admin?) %>
          <%= link_to "Delete Post", post, method: :delete, data: { confirm: "Are you sure?" } %>
        <% end %>
      <% end %>
    </div>
    <div>
      Post:<br />
      <%= markdown(post.content).html_safe %>
    </div>
    <div>
    </div>
   </div>
  <br /><br />
<% end %>

<%= link_to "Reply", "#{new_post_path}?discussion=#{@discussion.id}" %><br />

<%= link_to 'Back', forum_path(@discussion.forum) %>
